/*
 * Copyright (c) 2016-2019 VMware, Inc. All Rights Reserved.
 * This software is released under MIT license.
 * The full license information can be found in LICENSE in the root directory of this project.
 *
 */
import { ClrViewportViolation } from './enums/viewport-violation.enum';
import { ClrAlignment } from './enums/alignment.enum';
export const flipSides = position => {
    return Object.assign(Object.assign({}, position), { side: -1 * position.side });
};
// This could be used in more advanced positioning algorithms.
// flipAxisFlipSideAndNudgeContent(flipAxis, flipSide, nudge, nudgeForward?): ClrTransform {...}
// I would like to keep it for now.
export const flipAxis = position => {
    return Object.assign(Object.assign({}, position), { axis: position.axis === 0 ? 1 : 0 });
};
export const nudgeContent = (position, forward) => {
    const nextAlignment = position.content + (forward ? 0.5 : -0.5);
    if (nextAlignment < 0 || nextAlignment > 1) {
        return position;
    }
    else {
        return Object.assign(Object.assign({}, position), { content: nextAlignment });
    }
};
export function flipSidesAndNudgeContent(flip, nudge, nudgeBack) {
    return (position) => nudge(flip(position), nudgeBack);
}
export function align(position, anchor, content) {
    let xDiff = anchor.left;
    let yDiff = anchor.top;
    // When ClrAxis is VERTICAL BEFORE = left, AFTER = right
    // When ClrAxis is HORIZONTAL BEFORE is top, AFTER is bottom
    switch (position.axis + position.side) {
        case -1: {
            // ClrAxis.VERTICAL + ClrSide.BEFORE
            xDiff += alignHorizontal(position, anchor, content);
            yDiff -= content.height; // pull content up to the top of the anchor
            break;
        }
        case 1: {
            // ClrAxis.VERTICAL + ClrSide.AFTER
            xDiff += alignHorizontal(position, anchor, content);
            yDiff += anchor.height; // push the content down to below the anchor
            break;
        }
        case 0: {
            // ClrAxis.HORIZONTAL + ClrSide.BEFORE
            xDiff -= content.width; // pull the content left of the anchor
            yDiff += alignVertical(position, anchor, content);
            break;
        }
        case 2: {
            // ClrAxis.HORIZONTAL + ClrSide.AFTER
            xDiff += anchor.width; // push the content right of of the anchor
            yDiff += alignVertical(position, anchor, content);
            break;
        }
        default: {
            break;
        }
    }
    return { xOffset: xDiff, yOffset: yDiff };
}
function alignHorizontal(position, anchor, content) {
    let horizontalOffset = 0;
    // horizontal offset for the anchor position
    switch (position.anchor /*calculate for the anchor alignment*/) {
        case ClrAlignment.START: {
            // nothing to calculate here
            break;
        }
        case ClrAlignment.CENTER: {
            horizontalOffset += anchor.width / 2; // push content over 1/2 anchor width
            break;
        }
        case ClrAlignment.END: {
            horizontalOffset += anchor.width; //  push content over width of the anchor
            break;
        }
        default: {
            break;
        }
    }
    // horizontal offsets for anchor alignment
    switch (position.content // calculate for the content alignment
    ) {
        case ClrAlignment.START: {
            // Nothing to calculate here
            break;
        }
        case ClrAlignment.CENTER: {
            horizontalOffset -= content.width / 2; // pull content left by a value of 1/2 content width
            break;
        }
        case ClrAlignment.END: {
            // subtract the width of currentContent from horizontalOffset to pull it back
            horizontalOffset -= content.width;
            break;
        }
        default: {
            break;
        }
    }
    return horizontalOffset;
}
function alignVertical(position, anchor, content) {
    // y axis offsets for anchor alignment
    let verticalOffset = 0;
    // Calculate y offset for anchor position
    switch (position.anchor) {
        case ClrAlignment.START: {
            // nothing to calculate here
            break;
        }
        case ClrAlignment.CENTER: {
            verticalOffset += anchor.height / 2; // push content down to the middle of the anchor rect
            break;
        }
        case ClrAlignment.END: {
            verticalOffset += anchor.height; // push content down to the bottom of the anchor
            break;
        }
        default: {
            break;
        }
    }
    // Calculate y offsets for content alignment
    switch (position.content) {
        case ClrAlignment.START: {
            // aligned to the top of the content rect
            break;
        }
        case ClrAlignment.CENTER: {
            verticalOffset -= content.height / 2; // pull content back up to the middle of the content rect
            break;
        }
        case ClrAlignment.END: {
            verticalOffset -= content.height; // pull content back up to the bottom of the content rect
            break;
        }
        default: {
            break;
        }
    }
    return verticalOffset;
}
export function testVisibility(offset, content) {
    const violations = [];
    const mockCoords = {
        bottom: offset.yOffset + content.height,
        left: offset.xOffset,
        right: offset.xOffset + content.width,
        top: offset.yOffset,
    };
    if (!(mockCoords.top >= 0)) {
        violations.push(ClrViewportViolation.TOP);
    }
    if (!(mockCoords.left >= 0)) {
        violations.push(ClrViewportViolation.LEFT);
    }
    if (!(mockCoords.bottom <= (window.innerHeight || document.documentElement.clientHeight))) {
        violations.push(ClrViewportViolation.BOTTOM);
    }
    if (!(mockCoords.right <= (window.innerWidth || document.documentElement.clientWidth))) {
        violations.push(ClrViewportViolation.RIGHT);
    }
    return violations;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zaXRpb24tb3BlcmF0b3JzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvY2xyLWFuZ3VsYXIvc3JjL3V0aWxzL3BvcG92ZXIvcG9zaXRpb24tb3BlcmF0b3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztHQUtHO0FBSUgsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFFdkUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBS3RELE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBaUIsUUFBUSxDQUFDLEVBQUU7SUFDaEQsdUNBQ0ssUUFBUSxLQUNYLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsSUFBSSxJQUN4QjtBQUNKLENBQUMsQ0FBQztBQUVGLDhEQUE4RDtBQUM5RCxnR0FBZ0c7QUFDaEcsbUNBQW1DO0FBQ25DLE1BQU0sQ0FBQyxNQUFNLFFBQVEsR0FBaUIsUUFBUSxDQUFDLEVBQUU7SUFDL0MsdUNBQ0ssUUFBUSxLQUNYLElBQUksRUFBRSxRQUFRLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQ2pDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFpQixDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsRUFBRTtJQUM5RCxNQUFNLGFBQWEsR0FBRyxRQUFRLENBQUMsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDaEUsSUFBSSxhQUFhLEdBQUcsQ0FBQyxJQUFJLGFBQWEsR0FBRyxDQUFDLEVBQUU7UUFDMUMsT0FBTyxRQUFRLENBQUM7S0FDakI7U0FBTTtRQUNMLHVDQUNLLFFBQVEsS0FDWCxPQUFPLEVBQUUsYUFBYSxJQUN0QjtL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QUFDLENBQUMsRUFBRTtRQUN0RixVQUFVLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQzdDO0lBRUQsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTYtMjAxOSBWTXdhcmUsIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIFRoaXMgc29mdHdhcmUgaXMgcmVsZWFzZWQgdW5kZXIgTUlUIGxpY2Vuc2UuXG4gKiBUaGUgZnVsbCBsaWNlbnNlIGluZm9ybWF0aW9uIGNhbiBiZSBmb3VuZCBpbiBMSUNFTlNFIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHByb2plY3QuXG4gKlxuICovXG5cbmltcG9ydCB7IENsclBvcG92ZXJQb3NpdGlvbiB9IGZyb20gJy4vaW50ZXJmYWNlcy9wb3BvdmVyLXBvc2l0aW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBDbHJQb3BvdmVyQ29udGVudE9mZnNldCB9IGZyb20gJy4vaW50ZXJmYWNlcy9wb3BvdmVyLWNvbnRlbnQtb2Zmc2V0LmludGVyZmFjZSc7XG5pbXBvcnQgeyBDbHJWaWV3cG9ydFZpb2xhdGlvbiB9IGZyb20gJy4vZW51bXMvdmlld3BvcnQtdmlvbGF0aW9uLmVudW0nO1xuaW1wb3J0IHsgQ2xyVmlzaWJpbGl0eUNvb3JkcyB9IGZyb20gJy4vaW50ZXJmYWNlcy92aXNpYmlsaXR5LWNvb3Jkcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgQ2xyQWxpZ25tZW50IH0gZnJvbSAnLi9lbnVtcy9hbGlnbm1lbnQuZW51bSc7XG5cbi8vIFB1dCB0aGUgZm9yd2FyZCBhcmcgaGVyZSBidXQgaXQgaXMgb25seSBuZWVkZWQgd2hlbiBudWRnaW5nIGNvbnRlbnQgb3IgYW5jaG9ycy5cbmV4cG9ydCB0eXBlIENsclRyYW5zZm9ybSA9IChwb3NpdGlvbjogQ2xyUG9wb3ZlclBvc2l0aW9uLCBiYWNrPzogYm9vbGVhbikgPT4gQ2xyUG9wb3ZlclBvc2l0aW9uO1xuXG5leHBvcnQgY29uc3QgZmxpcFNpZGVzOiBDbHJUcmFuc2Zvcm0gPSBwb3NpdGlvbiA9PiB7XG4gIHJldHVybiB7XG4gICAgLi4ucG9zaXRpb24sXG4gICAgc2lkZTogLTEgKiBwb3NpdGlvbi5zaWRlLFxuICB9O1xufTtcblxuLy8gVGhpcyBjb3VsZCBiZSB1c2VkIGluIG1vcmUgYWR2YW5jZWQgcG9zaXRpb25pbmcgYWxnb3JpdGhtcy5cbi8vIGZsaXBBeGlzRmxpcFNpZGVBbmROdWRnZUNvbnRlbnQoZmxpcEF4aXMsIGZsaXBTaWRlLCBudWRnZSwgbnVkZ2VGb3J3YXJkPyk6IENsclRyYW5zZm9ybSB7Li4ufVxuLy8gSSB3b3VsZCBsaWtlIHRvIGtlZXAgaXQgZm9yIG5vdy5cbmV4cG9ydCBjb25zdCBmbGlwQXhpczogQ2xyVHJhbnNmb3JtID0gcG9zaXRpb24gPT4ge1xuICByZXR1cm4ge1xuICAgIC4uLnBvc2l0aW9uLFxuICAgIGF4aXM6IHBvc2l0aW9uLmF4aXMgPT09IDAgPyAxIDogMCxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBudWRnZUNvbnRlbnQ6IENsclRyYW5zZm9ybSA9IChwb3NpdGlvbiwgZm9yd2FyZCkgPT4ge1xuICBjb25zdCBuZXh0QWxpZ25tZW50ID0gcG9zaXRpb24uY29udGVudCArIChmb3J3YXJkID8gMC41IDogLTAuNSk7XG4gIGlmIChuZXh0QWxpZ25tZW50IDwgMCB8fCBuZXh0QWxpZ25tZW50ID4gMSkge1xuICAgIHJldHVybiBwb3NpdGlvbjtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgLi4ucG9zaXRpb24sXG4gICAgICBjb250ZW50OiBuZXh0QWxpZ25tZW50LFxuICAgIH07XG4gIH1cbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBmbGlwU2lkZXNBbmROdWRnZUNvbnRlbnQoZmxpcDogQ2xyVHJhbnNmb3JtLCBudWRnZTogQ2xyVHJhbnNmb3JtLCBudWRnZUJhY2s/OiBib29sZWFuKTogQ2xyVHJhbnNmb3JtIHtcbiAgcmV0dXJuIChwb3NpdGlvbjogQ2xyUG9wb3ZlclBvc2l0aW9uKTogQ2xyUG9wb3ZlclBvc2l0aW9uID0+IG51ZGdlKGZsaXAocG9zaXRpb24pLCBudWRnZUJhY2spO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWxpZ24ocG9zaXRpb246IENsclBvcG92ZXJQb3NpdGlvbiwgYW5jaG9yOiBDbGllbnRSZWN0LCBjb250ZW50OiBDbGllbnRSZWN0KTogQ2xyUG9wb3ZlckNvbnRlbnRPZmZzZXQge1xuICBsZXQgeERpZmYgPSBhbmNob3IubGVmdDtcbiAgbGV0IHlEaWZmID0gYW5jaG9yLnRvcDtcblxuICAvLyBXaGVuIENsckF4aXMgaXMgVkVSVElDQUwgQkVGT1JFID0gbGVmdCwgQUZURVIgPSByaWdodFxuICAvLyBXaGVuIENsckF4aXMgaXMgSE9SSVpPTlRBTCBCRUZPUkUgaXMgdG9wLCBBRlRFUiBpcyBib3R0b21cbiAgc3dpdGNoIChwb3NpdGlvbi5heGlzICsgcG9zaXRpb24uc2lkZSkge1xuICAgIGNhc2UgLTE6IHtcbiAgICAgIC8vIENsckF4aXMuVkVSVElDQUwgKyBDbHJTaWRlLkJFRk9SRVxuICAgICAgeERpZmYgKz0gYWxpZ25Ib3Jpem9udGFsKHBvc2l0aW9uLCBhbmNob3IsIGNvbnRlbnQpO1xuICAgICAgeURpZmYgLT0gY29udGVudC5oZWlnaHQ7IC8vIHB1bGwgY29udGVudCB1cCB0byB0aGUgdG9wIG9mIHRoZSBhbmNob3JcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIDE6IHtcbiAgICAgIC8vIENsckF4aXMuVkVSVElDQUwgKyBDbHJTaWRlLkFGVEVSXG4gICAgICB4RGlmZiArPSBhbGlnbkhvcml6b250YWwocG9zaXRpb24sIGFuY2hvciwgY29udGVudCk7XG4gICAgICB5RGlmZiArPSBhbmNob3IuaGVpZ2h0OyAvLyBwdXNoIHRoZSBjb250ZW50IGRvd24gdG8gYmVsb3cgdGhlIGFuY2hvclxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgMDoge1xuICAgICAgLy8gQ2xyQXhpcy5IT1JJWk9OVEFMICsgQ2xyU2lkZS5CRUZPUkVcbiAgICAgIHhEaWZmIC09IGNvbnRlbnQud2lkdGg7IC8vIHB1bGwgdGhlIGNvbnRlbnQgbGVmdCBvZiB0aGUgYW5jaG9yXG4gICAgICB5RGlmZiArPSBhbGlnblZlcnRpY2FsKHBvc2l0aW9uLCBhbmNob3IsIGNvbnRlbnQpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgMjoge1xuICAgICAgLy8gQ2xyQXhpcy5IT1JJWk9OVEFMICsgQ2xyU2lkZS5BRlRFUlxuICAgICAgeERpZmYgKz0gYW5jaG9yLndpZHRoOyAvLyBwdXNoIHRoZSBjb250ZW50IHJpZ2h0IG9mIG9mIHRoZSBhbmNob3JcbiAgICAgIHlEaWZmICs9IGFsaWduVmVydGljYWwocG9zaXRpb24sIGFuY2hvciwgY29udGVudCk7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIHJldHVybiB7IHhPZmZzZXQ6IHhEaWZmLCB5T2Zmc2V0OiB5RGlmZiB9O1xufVxuXG5mdW5jdGlvbiBhbGlnbkhvcml6b250YWwocG9zaXRpb246IENsclBvcG92ZXJQb3NpdGlvbiwgYW5jaG9yOiBDbGllbnRSZWN0LCBjb250ZW50OiBDbGllbnRSZWN0KTogbnVtYmVyIHtcbiAgbGV0IGhvcml6b250YWxPZmZzZXQgPSAwO1xuICAvLyBob3Jpem9udGFsIG9mZnNldCBmb3IgdGhlIGFuY2hvciBwb3NpdGlvblxuICBzd2l0Y2ggKHBvc2l0aW9uLmFuY2hvciAvKmNhbGN1bGF0ZSBmb3IgdGhlIGFuY2hvciBhbGlnbm1lbnQqLykge1xuICAgIGNhc2UgQ2xyQWxpZ25tZW50LlNUQVJUOiB7XG4gICAgICAvLyBub3RoaW5nIHRvIGNhbGN1bGF0ZSBoZXJlXG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSBDbHJBbGlnbm1lbnQuQ0VOVEVSOiB7XG4gICAgICBob3Jpem9udGFsT2Zmc2V0ICs9IGFuY2hvci53aWR0aCAvIDI7IC8vIHB1c2ggY29udGVudCBvdmVyIDEvMiBhbmNob3Igd2lkdGhcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIENsckFsaWdubWVudC5FTkQ6IHtcbiAgICAgIGhvcml6b250YWxPZmZzZXQgKz0gYW5jaG9yLndpZHRoOyAvLyAgcHVzaCBjb250ZW50IG92ZXIgd2lkdGggb2YgdGhlIGFuY2hvclxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8vIGhvcml6b250YWwgb2Zmc2V0cyBmb3IgYW5jaG9yIGFsaWdubWVudFxuICBzd2l0Y2ggKFxuICAgIHBvc2l0aW9uLmNvbnRlbnQgLy8gY2FsY3VsYXRlIGZvciB0aGUgY29udGVudCBhbGlnbm1lbnRcbiAgKSB7XG4gICAgY2FzZSBDbHJBbGlnbm1lbnQuU1RBUlQ6IHtcbiAgICAgIC8vIE5vdGhpbmcgdG8gY2FsY3VsYXRlIGhlcmVcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIENsckFsaWdubWVudC5DRU5URVI6IHtcbiAgICAgIGhvcml6b250YWxPZmZzZXQgLT0gY29udGVudC53aWR0aCAvIDI7IC8vIHB1bGwgY29udGVudCBsZWZ0IGJ5IGEgdmFsdWUgb2YgMS8yIGNvbnRlbnQgd2lkdGhcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIENsckFsaWdubWVudC5FTkQ6IHtcbiAgICAgIC8vIHN1YnRyYWN0IHRoZSB3aWR0aCBvZiBjdXJyZW50Q29udGVudCBmcm9tIGhvcml6b250YWxPZmZzZXQgdG8gcHVsbCBpdCBiYWNrXG4gICAgICBob3Jpem9udGFsT2Zmc2V0IC09IGNvbnRlbnQud2lkdGg7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGhvcml6b250YWxPZmZzZXQ7XG59XG5cbmZ1bmN0aW9uIGFsaWduVmVydGljYWwocG9zaXRpb246IENsclBvcG92ZXJQb3NpdGlvbiwgYW5jaG9yOiBDbGllbnRSZWN0LCBjb250ZW50OiBDbGllbnRSZWN0KTogbnVtYmVyIHtcbiAgLy8geSBheGlzIG9mZnNldHMgZm9yIGFuY2hvciBhbGlnbm1lbnRcbiAgbGV0IHZlcnRpY2FsT2Zmc2V0ID0gMDtcblxuICAvLyBDYWxjdWxhdGUgeSBvZmZzZXQgZm9yIGFuY2hvciBwb3NpdGlvblxuICBzd2l0Y2ggKHBvc2l0aW9uLmFuY2hvcikge1xuICAgIGNhc2UgQ2xyQWxpZ25tZW50LlNUQVJUOiB7XG4gICAgICAvLyBub3RoaW5nIHRvIGNhbGN1bGF0ZSBoZXJlXG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSBDbHJBbGlnbm1lbnQuQ0VOVEVSOiB7XG4gICAgICB2ZXJ0aWNhbE9mZnNldCArPSBhbmNob3IuaGVpZ2h0IC8gMjsgLy8gcHVzaCBjb250ZW50IGRvd24gdG8gdGhlIG1pZGRsZSBvZiB0aGUgYW5jaG9yIHJlY3RcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIENsckFsaWdubWVudC5FTkQ6IHtcbiAgICAgIHZlcnRpY2FsT2Zmc2V0ICs9IGFuY2hvci5oZWlnaHQ7IC8vIHB1c2ggY29udGVudCBkb3duIHRvIHRoZSBib3R0b20gb2YgdGhlIGFuY2hvclxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8vIENhbGN1bGF0ZSB5IG9mZnNldHMgZm9yIGNvbnRlbnQgYWxpZ25tZW50XG4gIHN3aXRjaCAocG9zaXRpb24uY29udGVudCkge1xuICAgIGNhc2UgQ2xyQWxpZ25tZW50LlNUQVJUOiB7XG4gICAgICAvLyBhbGlnbmVkIHRvIHRoZSB0b3Agb2YgdGhlIGNvbnRlbnQgcmVjdFxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgQ2xyQWxpZ25tZW50LkNFTlRFUjoge1xuICAgICAgdmVydGljYWxPZmZzZXQgLT0gY29udGVudC5oZWlnaHQgLyAyOyAvLyBwdWxsIGNvbnRlbnQgYmFjayB1cCB0byB0aGUgbWlkZGxlIG9mIHRoZSBjb250ZW50IHJlY3RcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIENsckFsaWdubWVudC5FTkQ6IHtcbiAgICAgIHZlcnRpY2FsT2Zmc2V0IC09IGNvbnRlbnQuaGVpZ2h0OyAvLyBwdWxsIGNvbnRlbnQgYmFjayB1cCB0byB0aGUgYm90dG9tIG9mIHRoZSBjb250ZW50IHJlY3RcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHZlcnRpY2FsT2Zmc2V0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdGVzdFZpc2liaWxpdHkob2Zmc2V0OiBDbHJQb3BvdmVyQ29udGVudE9mZnNldCwgY29udGVudDogQ2xpZW50UmVjdCk6IENsclZpZXdwb3J0VmlvbGF0aW9uW10ge1xuICBjb25zdCB2aW9sYXRpb25zOiBDbHJWaWV3cG9ydFZpb2xhdGlvbltdID0gW107XG4gIGNvbnN0IG1vY2tDb29yZHM6IENsclZpc2liaWxpdHlDb29yZHMgPSB7XG4gICAgYm90dG9tOiBvZmZzZXQueU9mZnNldCArIGNvbnRlbnQuaGVpZ2h0LFxuICAgIGxlZnQ6IG9mZnNldC54T2Zmc2V0LFxuICAgIHJpZ2h0OiBvZmZzZXQueE9mZnNldCArIGNvbnRlbnQud2lkdGgsXG4gICAgdG9wOiBvZmZzZXQueU9mZnNldCxcbiAgfTtcblxuICBpZiAoIShtb2NrQ29vcmRzLnRvcCA+PSAwKSkge1xuICAgIHZpb2xhdGlvbnMucHVzaChDbHJWaWV3cG9ydFZpb2xhdGlvbi5UT1ApO1xuICB9XG4gIGlmICghKG1vY2tDb29yZHMubGVmdCA+PSAwKSkge1xuICAgIHZpb2xhdGlvbnMucHVzaChDbHJWaWV3cG9ydFZpb2xhdGlvbi5MRUZUKTtcbiAgfVxuICBpZiAoIShtb2NrQ29vcmRzLmJvdHRvbSA8PSAod2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpKSkge1xuICAgIHZpb2xhdGlvbnMucHVzaChDbHJWaWV3cG9ydFZpb2xhdGlvbi5CT1RUT00pO1xuICB9XG4gIGlmICghKG1vY2tDb29yZHMucmlnaHQgPD0gKHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCkpKSB7XG4gICAgdmlvbGF0aW9ucy5wdXNoKENsclZpZXdwb3J0VmlvbGF0aW9uLlJJR0hUKTtcbiAgfVxuXG4gIHJldHVybiB2aW9sYXRpb25zO1xufVxuIl19